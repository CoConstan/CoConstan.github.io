<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Manipuler des donn√©es avec Pandas | Corentin Constanza </title> <meta name="author" content="Corentin Constanza"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://coconstan.github.io/projects/Manipuler_des_donn%C3%A9es/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Corentin</span> Constanza </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <style>.sidebar{width:300px;position:fixed;top:100px;left:20px;background:var(--global-bg-color);border:1px solid var(--global-border-color);color:var(--global-text-color);padding:15px;border-radius:8px}.sidebar a{color:var(--global-text-color);text-decoration:none}.sidebar a:hover{color:var(--global-theme-color)}</style> <style>#toc-container{position:fixed;top:100px;right:40px;width:260px;max-height:70vh;overflow-y:auto;background:var(--global-bg-color);color:var(--global-text-color);border:1px solid var(--global-border-color);border-radius:10px;padding:15px 20px;box-shadow:0 2px 10px rgba(0,0,0,0.1);z-index:100}#toc-container .toc-title{font-weight:600;margin-bottom:10px;text-align:center;color:var(--global-theme-color)}#toc-container ul{list-style:none;padding-left:10px;margin:0}#toc-container a{text-decoration:none;color:var(--global-text-color);transition:color .2s}#toc-container a:hover{color:var(--global-theme-color)}@media(max-width:1000px){#toc-container{display:none}}thead{border-bottom:3px solid rgba(0,79,140,0.5)}tbody tr{border-bottom:1px solid rgba(0,79,140,0.5)}</style> <nav class="sidebar"> <h3></h3> <ul> <li><a href="/projects/Numpy">Numpy</a></li> <li><a href="/projects/Pandas">Introduction √† Pandas</a></li> <li><a href="/projects/Manipuler_des_donn%C3%A9es">Manipuler des donn√©es avec Pandas</a></li> </ul> </nav> <div class="post"> <header class="post-header"> <h1 class="post-title">Manipuler des donn√©es avec Pandas</h1> <p class="post-description"></p> </header> <article> <h1 id="1-introdution">1 <strong>Introdution</strong> </h1> <p>Le chapitre d‚Äôintroduction √† <code class="language-plaintext highlighter-rouge">Pandas</code> a permis de pr√©senter le principe des donn√©es organis√©es sous la forme d‚Äôun <code class="language-plaintext highlighter-rouge">DataFrame</code>, ainsi que la praticit√© de l‚Äô√©cosyst√®me <code class="language-plaintext highlighter-rouge">Pandas</code> pour r√©aliser des op√©rations simples sur un jeu de donn√©es.</p> <p>Dans la pratique, il est rare de travailler sur une source de donn√©es isol√©e. Un jeu de donn√©es prend toute sa valeur lorsqu‚Äôil est mis en relation avec d‚Äôautres sources. Pour les chercheurs, cette mise en perspective permet de contextualiser l‚Äôinformation contenue dans une source en la comparant ou en la combinant avec d‚Äôautres. Dans le secteur priv√©, les data scientists cherchent souvent √† associer des informations relatives √† une m√™me entit√© (par exemple, un client) issues de plusieurs bases, ou √† comparer les individus entre eux.</p> <p>L‚Äôun des grands atouts des outils modernes de data science ‚Äî et de <code class="language-plaintext highlighter-rouge">Pandas</code> en particulier ‚Äî r√©side dans la facilit√© avec laquelle ils permettent de restructurer et de combiner des sources de donn√©es pour mener une analyse int√©gr√©e. Ce chapitre vient consolider les notions introduites pr√©c√©demment en affinant les traitements appliqu√©s aux donn√©es. Il se concentrera principalement sur deux types d‚Äôop√©rations :</p> <ul> <li> <p>les statistiques descriptives par groupe ;</p> </li> <li> <p>l‚Äôassociation de donn√©es √† partir de caract√©ristiques communes.</p> </li> </ul> <p>R√©aliser ce travail de mani√®re simple, fiable et efficace est une comp√©tence essentielle pour tout data scientist, tant cette t√¢che est fr√©quente dans la pratique. Heureusement, Pandas offre des outils puissants et intuitifs pour accomplir ce type de traitement sur des donn√©es structur√©es.</p> <p>Ce travail constitue une √©tape cl√© : il nous permettra de mieux comprendre un ph√©nom√®ne r√©el gr√¢ce √† des statistiques descriptives d√©taill√©es, avant de passer √† la statistique inf√©rentielle, qui vise √† formaliser et g√©n√©raliser les liens de corr√©lation ou de causalit√© entre des caract√©ristiques observ√©es et un ph√©nom√®ne √©tudi√©.</p> <h2 id="11-environment">1.1 Environment</h2> <p>Le chapitre pr√©c√©dent utilisait quasi exclusivement la librairie <code class="language-plaintext highlighter-rouge">Pandas</code>. Nous allons dans ce chapitre utiliser d‚Äôautres packages en compl√©ment de celui-ci.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">xlrd</span> <span class="o">--</span><span class="n">quiet</span>
<span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">pynsee</span> <span class="o">--</span><span class="n">quiet</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">pynsee</span>
<span class="kn">import</span> <span class="n">pynsee.download</span>
</code></pre></div></div> <p>Pour obtenir des r√©sultats reproductibles, on fixe la racine du g√©n√©rateur pseudo-al√©atoire.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</code></pre></div></div> <h2 id="12-donn√©es">1.2 Donn√©es</h2> <p>Dans ce chapitre, nous allons travailler sur des donn√©es issues de l‚ÄôInsee et de l‚ÄôADEME :</p> <ul> <li> <p>Les √©missions de gaz √† effet de serre estim√©es au niveau communal par l‚ÄôADEME. Le jeu de donn√©es est disponible sur <a href="https://www.data.gouv.fr/fr/datasets/inventaire-de-gaz-a-effet-de-serre-territorialise/#_" rel="external nofollow noopener" target="_blank">data.gouv</a> et requ√™table directement dans <code class="language-plaintext highlighter-rouge">Python</code>.</p> </li> <li> <p>Le <a href="https://www.insee.fr/fr/statistiques/fichier/6800675/v_commune_2023.csv" rel="external nofollow noopener" target="_blank">code officiel g√©ographique</a> de l‚ÄôInsee. Il permet d‚Äôidentifier les communes fran√ßaises √† partir d‚Äôun code univoque (code INSEE).</p> </li> <li> <p>Les donn√©es <a href="https://www.insee.fr/fr/metadonnees/source/serie/s1172" rel="external nofollow noopener" target="_blank">Filosofi</a> constituant une source d‚Äôinformation sur les revenus des Fran√ßais √† une √©chelle spatiale fine, √©labor√©e par l‚ÄôInsee √† partir des d√©clarations fiscales et des donn√©es relatives aux prestations sociales. Dans notre cas, nous utiliserons les niveaux de revenu et les donn√©es de population au niveau communal, afin de les mettre en relation avec nos donn√©es d‚Äô√©missions.</p> </li> </ul> <p>Pour faciliter l‚Äôimport de donn√©es Insee, il est recommand√© d‚Äôutiliser le package <code class="language-plaintext highlighter-rouge">pynsee</code> qui simplifie l‚Äôacc√®s aux principaux jeux de donn√©es de l‚ÄôInsee disponibles sur le site web insee.fr ou via des API. La liste des jeux de donn√©es disponibles est consultable <a href="https://inseefrlab.github.io/DoReMIFaSol/articles/donnees_dispo.html" rel="external nofollow noopener" target="_blank">ici</a>.</p> <h1 id="2-recup√©ration-des-donn√©es">2 <strong>Recup√©ration des donn√©es</strong> </h1> <h2 id="21-donn√©es-ademe">2.1 Donn√©es ADEME</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://koumoul.com/s/data-fair/api/v1/datasets/igt-pouvoir-de-rechauffement-global/convert</span><span class="sh">"</span>
<span class="n">emissions</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">emissions</span><span class="p">.</span><span class="nf">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">secteurs</span> <span class="o">=</span> <span class="n">emissions</span><span class="p">.</span><span class="nf">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">).</span><span class="n">columns</span>
<span class="n">emissions</span><span class="p">[</span><span class="sh">"</span><span class="s">dep</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">emissions</span><span class="p">[</span><span class="sh">"</span><span class="s">INSEE commune</span><span class="sh">"</span><span class="p">].</span><span class="nb">str</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</code></pre></div></div> <h2 id="22-donn√©es-filosofi">2.2 Donn√©es Filosofi</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pynsee.download</span> <span class="kn">import</span> <span class="n">download_file</span>
<span class="n">filosofi</span> <span class="o">=</span> <span class="nf">download_file</span><span class="p">(</span><span class="sh">"</span><span class="s">FILOSOFI_COM_2016</span><span class="sh">"</span><span class="p">)</span>
<span class="n">filosofi</span><span class="p">.</span><span class="nf">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></div> <p>Pandas a g√©r√© automatiquement les types de variables. Il le fait relativement bien, mais une v√©rification est toujours utile pour les variables qui ont un statut sp√©cifique.</p> <p>Pour les variables qui ne sont pas en type float alors qu‚Äôelles devraient l‚Äô√™tre, on modifie leur type.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filosofi</span> <span class="o">=</span> <span class="p">(</span><span class="n">filosofi</span><span class="p">.</span><span class="nf">astype</span><span class="p">({</span><span class="n">c</span><span class="p">:</span> <span class="sh">"</span><span class="s">float</span><span class="sh">"</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">filosofi</span><span class="p">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:]}))</span>
</code></pre></div></div> <p>Un simple examen des donn√©es permet de se faire une id√©e assez pr√©cise de leur structure. On observe que certaines variables de Filosofi pr√©sentent de nombreuses valeurs manquantes ‚Äî en raison du secret statistique ‚Äî, tandis que d‚Äôautres sont plus compl√®tes. Il est donc essentiel de choisir avec soin les variables √† exploiter pour garantir la qualit√© de l‚Äôanalyse.</p> <p>Notre objectif, √† terme, est de relier les informations contenues dans ces deux jeux de donn√©es.Sans cette mise en correspondance, l‚Äôanalyse risquerait de rester incompl√®te : nous pourrions vouloir approfondir la compr√©hension des √©missions de gaz carbonique, mais serions limit√©s dans nos possibilit√©s d‚Äôinterpr√©tation sans l‚Äôapport d‚Äôinformations compl√©mentaires issues de Filosofi.</p> <h1 id="3-statistiques-descriptives-par-groupe">3 <strong>Statistiques descriptives par groupe</strong> </h1> <p>Dans le chapitre pr√©c√©dent, nous avons vu comment obtenir facilement des statistiques agr√©g√©es √† l‚Äôaide de Pandas. Cependant, il est fr√©quent de disposer de donn√©es comportant des strates d‚Äôanalyse interm√©diaires pertinentes ‚Äî par exemple, des variables g√©ographiques, des groupes socio-d√©mographiques li√©s √† certaines caract√©ristiques observ√©es, ou encore des indicateurs temporels.</p> <p>Nous allons rapidement calculer les statistique au niveau national en utilisant ce que nous avons appris pr√©c√©demment.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">emissions_totales</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">numeric_only</span> <span class="o">=</span> <span class="bp">True</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s">emissions</span><span class="sh">"</span><span class="p">]).</span><span class="nf">reset_index</span><span class="p">(</span><span class="n">names</span> <span class="o">=</span> <span class="sh">"</span><span class="s">secteur</span><span class="sh">"</span><span class="p">)</span>
<span class="n">emissions_totales</span><span class="p">[</span><span class="sh">'</span><span class="s">emissions (%)</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">emissions_totales</span><span class="p">[</span><span class="sh">'</span><span class="s">emissions</span><span class="sh">'</span><span class="p">]</span><span class="o">/</span><span class="n">emissions_totales</span><span class="p">[</span><span class="sh">'</span><span class="s">emissions</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">()</span>
<span class="n">emissions_totales</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">(</span><span class="sh">"</span><span class="s">emissions</span><span class="sh">"</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="bp">False</span><span class="p">).</span><span class="nf">round</span><span class="p">()</span>
</code></pre></div></div> <p>Nous pouvons voir que les secteurs les plus √©metteurs, √† savoir le transport, l‚Äôagriculture et l‚Äôindustrie, hors √©nergie. Le fait que l‚Äô√©nergie soit relativement peu √©mettrice s‚Äôexplique bien du fait du mix √©nerg√©tique fran√ßais o√π le nucl√©aire repr√©sente une majorit√© de la production √©lectrique.</p> <p>Mais qu‚Äôen est-il du profil d‚Äô√©mission des diff√©rents d√©partements ? Pour r√©pondre √† cette question, il sera n√©cessaire d‚Äôagr√©ger les donn√©es au niveau d√©partemental. Cette approche nous fournira une perspective compl√©mentaire, diff√©rente √† la fois de celle du niveau communal et du niveau national.</p> <p>En <code class="language-plaintext highlighter-rouge">SQL</code>, il est tr√®s simple de d√©couper les donn√©es pour effectuer des op√©rations sur des blocs coh√©rents, puis de rassembler les r√©sultats dans la dimension appropri√©e. Cette logique, connue sous le nom de <code class="language-plaintext highlighter-rouge">split‚Äìapply‚Äìcombine</code>, est √©galement au c≈ìur des langages de manipulation de donn√©es modernes ‚Äî et <code class="language-plaintext highlighter-rouge">Pandas</code> <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html" rel="external nofollow noopener" target="_blank">n‚Äôy fait pas exception</a>. Pour faire cela, en <code class="language-plaintext highlighter-rouge">Pandas</code>, on utilise la m√©thode <code class="language-plaintext highlighter-rouge">groupby()</code>.</p> <h2 id="31-exemple-1-d√©nombrement-par-groupe">3.1 Exemple 1: d√©nombrement par groupe</h2> <p>Pour illustrer le fonctionnement de <code class="language-plaintext highlighter-rouge">groupby()</code>, nous allons commencer par un exemple simple : compter le nombre de communes par d√©partement.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">from</span> <span class="n">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="n">cog_2023</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="nc">StringIO</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="p">))</span>
<span class="n">communes</span> <span class="o">=</span> <span class="n">cog_2023</span><span class="p">.</span><span class="n">loc</span><span class="p">[</span><span class="n">cog_2023</span><span class="p">[</span><span class="sh">'</span><span class="s">TYPECOM</span><span class="sh">'</span><span class="p">]</span><span class="o">==</span><span class="sh">"</span><span class="s">COM</span><span class="sh">"</span><span class="p">]</span>
<span class="n">communes</span><span class="p">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="sh">'</span><span class="s">COM</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">DEP</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">REG</span><span class="sh">'</span><span class="p">]].</span><span class="nf">nunique</span><span class="p">()</span>
</code></pre></div></div> <p>On obtient une serie index√©e. Ce n‚Äôest pas pratique, on pref√®re un DataFrame. On utilise donc la m√©thode <code class="language-plaintext highlighter-rouge">reset_index()</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">communes</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">DEP</span><span class="sh">'</span><span class="p">).</span><span class="nf">agg</span><span class="p">({</span><span class="sh">'</span><span class="s">COM</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">nunique</span><span class="sh">'</span><span class="p">}).</span><span class="nf">reset_index</span><span class="p">().</span><span class="nf">sort_values</span><span class="p">(</span><span class="sh">'</span><span class="s">COM</span><span class="sh">'</span><span class="p">,</span> <span class="n">ascending</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
</code></pre></div></div> <h2 id="32-exemple-2-agr√©gation-par-groupe">3.2 Exemple 2: agr√©gation par groupe</h2> <p>Pour illustrer l‚Äôutilisation d‚Äôagr√©ggats, nous allons utilis√© le jeu de donn√©es <code class="language-plaintext highlighter-rouge">filosofi</code> pour compter la population totale par d√©partement.</p> <p>Il y a deux mani√®res de faire cela : une implicite et une explicite.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Implicite =&gt; il faut faire attention √† l'ordre des op√©rations
</span><span class="n">filosofi</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">dep</span><span class="sh">'</span><span class="p">)[</span><span class="sh">'</span><span class="s">NBPERSMENFISC16</span><span class="sh">'</span><span class="p">].</span><span class="nf">sum</span><span class="p">()</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Explicite =&gt; plus verbeux mais plus clair
</span><span class="n">filosofi</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">dep</span><span class="sh">'</span><span class="p">).</span><span class="nf">agg</span><span class="p">({</span><span class="sh">'</span><span class="s">NBPERSMENFISC16</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">sum</span><span class="sh">'</span><span class="p">})</span>
</code></pre></div></div> <p>La seconde approche s‚Äôav√®re plus pratique, car elle renvoie directement un DataFrame Pandas, et non une s√©rie index√©e. √Ä partir de ce DataFrame, quelques manipulations simples suffisent pour obtenir un tableau exploitable d√©crivant la d√©mographie d√©partementale.</p> <p>Cependant, ce tableau reste encore assez brut, puisqu‚Äôil ne contient pour l‚Äôinstant que les num√©ros de d√©partement. Pour y ajouter le nom des d√©partements, il sera n√©cessaire d‚Äôutiliser une seconde base de donn√©es et de croiser les informations communes entre les deux sources (en l‚Äôoccurrence, le code du d√©partement). C‚Äôest l‚Äôobjet de la section suivante.</p> <h1 id="33-exercice-dapplication">3.3 Exercice d‚Äôapplication</h1> <p>Ce exercice utilise le jeu de donn√©es <code class="language-plaintext highlighter-rouge">emissions</code> pour calculer les √©missions totales de gaz √† effet de serre par d√©partement.</p> <details open="" style="border: 2px solid #4CAF50; border-radius: 8px; margin: 16px 0;"> <summary style="background: #E8F5E9; padding: 8px 12px; font-weight: bold; color: #0D47A1; cursor: pointer;"> üìù Exercice 1 </summary> <div style="padding: 12px;"> 1. Calculer les √©missions totales du secteur ‚ÄúR√©sidentiel‚Äù par d√©partement, puis rapporter ces valeurs √† celle du d√©partement le plus √©metteur dans ce domaine. Que pouvez-vous en conclure ?<br> 2. Calculer, pour chaque d√©partement, les √©missions totales de chaque secteur en pourcentage des √©missions totales du d√©partement. Que pouvez-vous en conclure ?<br> </div> </details> <h1 id="4-joindre-des-donn√©es">4 <strong>Joindre des donn√©es</strong> </h1> <p>Nous allons ici nous focaliser sur le cas le plus favorable qui est la situation o√π une information permet d‚Äôapparier de mani√®re exacte deux bases de donn√©es. Associer des donn√©es issues de sources diff√©rentes est une t√¢che courante en data science. Par exemple, pour une entreprise, elle peut posseder une base de donn√©es clients et une base de donn√©es de transactions, et souhaiter les combiner pour analyser le comportement d‚Äôachat de ses clients.</p> <p>Cette structuration en √©toile, est historiquement li√©e aux bases de donn√©es relationnelles, aujourd‚Äôhui il existe des alternatives plus flexibles sans structure <em>a priori</em> o√π l‚Äôinformation est empil√©e dans un datalake. Cependant, la structuration en √©toile reste tr√®s utilis√©e dans la pratique, notamment de compartimentation de l‚Äôinformation. On ne donne acc√®s qu‚Äôaux donn√©es n√©cessaires √† une t√¢che pr√©cise, ce qui permet de limiter les risques de fuites de donn√©es sensibles.</p> <p>On parle souvent de jointure de donn√©es, un h√©ritage du terme JOIN en SQL. En <code class="language-plaintext highlighter-rouge">Pandas</code>, et la mani√®re de d√©finir les jointures (left join, right join‚Ä¶) est directement inspir√©e de SQL. Cette op√©ration est r√©alis√©e √† l‚Äôaide de la m√©thode <code class="language-plaintext highlighter-rouge">merge()</code>.</p> <h2 id="41-mise-en-oeuvre">4.1 Mise en oeuvre</h2> <p>En Pandas, la m√©thode la plus pratique pour associer plusieurs jeux de donn√©es √† partir de caract√©ristiques communes est la fonction merge(). Ses principaux arguments permettent de contr√¥ler pr√©cis√©ment le type et le comportement de la jointure, offrant ainsi une grande flexibilit√© dans la mani√®re de combiner les sources d‚Äôinformation. Nous allons les explorer de fa√ßon visuelle afin d‚Äôen comprendre le fonctionnement.</p> <p>Dans notre cas d‚Äô√©tude ‚Äî la construction de statistiques sur les √©missions de gaz carbonique ‚Äî, la base de gauche correspondra au DataFrame <code class="language-plaintext highlighter-rouge">emission</code>, et la base de droite au DataFrame <code class="language-plaintext highlighter-rouge">filosofi</code>.</p> <p>On utilise le term cl√©(s) pour sp√©cifier la ou les colonnes communes aux deux DataFrames utilis√©es pour la jointure. Il n‚Äôest pas n√©cessaire que les noms des colonnes soient identiques dans les deux DataFrames, on peut utiliser les arguments <code class="language-plaintext highlighter-rouge">left_on</code> et <code class="language-plaintext highlighter-rouge">right_on</code> pour sp√©cifier les noms des colonnes dans chaque DataFrame. Cependant, elles doivent contenir des valeurs identiques pour que la jointure fonctionne correctement (sinon on obtient l‚Äôensemble vide).</p> <p>De mani√®re g√©n√©ral, les jointures sont effectuer sur des colonnes contenant des identifiants uniques (comme un code INSEE, un num√©ro de s√©curit√© sociale, un identifiant client‚Ä¶).</p> <p>Il existe quatre types de jointures principales :</p> <ul> <li> <p><strong>Inner join</strong> : ne conserve que les lignes ayant des valeurs correspondantes dans les deux DataFrames. C‚Äôest le type de jointure par d√©faut.</p> </li> <li> <p><strong>Left join</strong> : conserve toutes les lignes du DataFrame de gauche, et ajoute les colonnes du DataFrame de droite lorsque des correspondances sont trouv√©es. Les lignes sans correspondance dans le DataFrame de droite auront des valeurs NaN pour les colonnes ajout√©es.</p> </li> <li> <p><strong>Right join</strong> : conserve toutes les lignes du DataFrame de droite, et ajoute les colonnes du DataFrame de gauche lorsque des correspondances sont trouv√©es. Les lignes sans correspondance dans le DataFrame de gauche auront des valeurs NaN pour les colonnes ajout√©es.</p> </li> <li> <p><strong>Outer join</strong> : conserve toutes les lignes des deux DataFrames, en ajoutant des valeurs NaN pour les colonnes o√π il n‚Äôy a pas de correspondance.</p> </li> </ul> <h3 id="411-inner-join">4.1.1 Inner join</h3> <h2 id="42-exercice-dapplication">4.2 Exercice d‚Äôapplication</h2> <p>Cet exercice va revenir un peu en arri√®re afin de saisir pourquoi nous prenons le code INSEE de commune au lieu du nom de la commune pour faire les jointures.</p> <details open="" style="border: 2px solid #4CAF50; border-radius: 8px; margin: 16px 0;"> <summary style="background: #E8F5E9; padding: 8px 12px; font-weight: bold; color: #0D47A1; cursor: pointer;"> üìù Exercice 2 </summary> <div style="padding: 12px;"> 1. V√©rifier les dimensions des DataFrames.<br> 2. Identifier dans <code>filosofi</code> les noms de communes qui correspondent √† plusieurs codes communes et s√©lectionner leurs codes. En d‚Äôautres termes, identifier les <code>LIBGEO</code> tels qu‚Äôil existe des doublons de <code>CODGEO</code> et les stocker dans un vecteur <code>x</code> (conseil: faire attention √† l‚Äôindex de <code>x</code>).<br> 3. Regarder dans <code>filosofi</code> les observations o√π le libell√© comporte plus de deux codes communes diff√©rents.<br> 4. R√©ordonner la base obtenue par order alphab√©tique.<br> 5. D√©terminer la taille moyenne des communes (variable nombre de personnes: NBPERSMENFISC16) et quelques statistiques descriptives de ces donn√©es. Comparer aux m√™mes statistiques sur les donn√©es o√π libell√©s et codes communes co√Øncident.<br> 6. V√©rifier les grandes villes (&gt; 100 000 habitants) et regarder la proportion pour lequelles un m√™me nom est associ√© √† diff√©rents codes commune.<br> 7. V√©rifier dans <code>filosofi</code> combien de villes sont nomm√©es "Montreuil". De m√™me avec celle qui contiennent "Saint-Denis".<br> 8. Quelles conclusions peut-on tirer de cet exercice ?<br> </div> </details> <p>Nous allons maintenant calculer l‚Äôempreinte carbone par habitant.</p> <details open="" style="border: 2px solid #4CAF50; border-radius: 8px; margin: 16px 0;"> <summary style="background: #E8F5E9; padding: 8px 12px; font-weight: bold; color: #0D47A1; cursor: pointer;"> üìù Exercice 3 </summary> <div style="padding: 12px;"> 1. Cr√©er une variable <code>emissions</code> qui correspond aux √©missions totales d‚Äôune commune.<br> 2. Faire une jointure √† gauche entre les donn√©es d‚Äô√©missions et les donn√©es de cadrage.<br> 3. Calculer l‚Äôempreinte carbone (√©missions totales / population). <br> 4. Faire un histogramme de l‚Äôempreinte carbone du log de l'empreinte carbone.<br> 5. Regarder la corr√©lation entre les variables et l‚Äôempreinte carbone. Certaines variables semblent-elles pouvoir potentiellement influer sur l‚Äôempreinte carbone ? </div> </details> </article> <h2>References</h2> <div class="publications"> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> ¬© Copyright 2025 Corentin Constanza. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>